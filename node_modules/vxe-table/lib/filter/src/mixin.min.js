"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils")),_tools=require("../../tools"),_util=require("../../table/src/util"),_vXETable=_interopRequireDefault(require("../../v-x-e-table"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var _default={methods:{_openFilter:function(e){var t=(0,_util.handleFieldOrColumn)(this,e);if(t&&t.filters){var i=this.elemStore,l=t.fixed;return this.scrollToColumn(t).then(function(){var e=i["".concat(l||"main","-header-wrapper")]||i["main-header-wrapper"];e&&(e=e.querySelector(".vxe-header--column.".concat(t.id," .vxe-filter--btn")),_tools.DomTools.triggerEvent(e,"click"))})}return this.$nextTick()},_setFilter:function(e,t){e=(0,_util.handleFieldOrColumn)(this,e);return e&&e.filters&&t&&(e.filters=_tools.UtilTools.getFilters(t)),this.$nextTick()},checkFilterOptions:function(){var e=this.filterStore;e.isAllSelected=e.options.every(function(e){return e._checked}),e.isIndeterminate=!e.isAllSelected&&e.options.some(function(e){return e._checked})},triggerFilterEvent:function(e,u,t){var h,d,i,l,r,o,p,v=this,m=this.filterStore;m.column===u&&m.visible?m.visible=!1:(h=e.target,d=e.pageX,i=u.filters,l=u.filterMultiple,r=(r=u.filterRender)?_vXETable.default.renderer.get(r.name):null,o=u.filterRecoverMethod||(r?r.filterRecoverMethod:null),p=_tools.DomTools.getDomNode().visibleWidth,Object.assign(m,{args:t,multiple:l,options:i,column:u,style:null,visible:!0}),m.options.forEach(function(e){var t=e._checked,i=e.checked;(e._checked=i)||t===i||o&&o({option:e,column:u,$table:v})}),this.checkFilterOptions(),this.initStore.filter=!0,this.$nextTick(function(){var e=v.$refs,t=e.tableBody.$el,i=e.filterWrapper.$el,l=0,r=0,o=null,n=null;i&&(l=i.offsetWidth,r=i.offsetHeight,o=i.querySelector(".vxe-table--filter-header"),n=i.querySelector(".vxe-table--filter-footer"));var s,f,a=l/2,c=t.clientWidth-l-10,e={top:"".concat(h.offsetTop+h.offsetParent.offsetTop+h.offsetHeight+8,"px")},i=null;r>=t.clientHeight&&(i=Math.max(60,t.clientHeight-(n?n.offsetHeight:0)-(o?o.offsetHeight:0))),"left"===u.fixed?s=h.offsetLeft+h.offsetParent.offsetLeft-a:"right"===u.fixed?f=h.offsetParent.offsetWidth-h.offsetLeft+(h.offsetParent.offsetParent.offsetWidth-h.offsetParent.offsetLeft)-u.renderWidth-a:s=h.offsetLeft+h.offsetParent.offsetLeft-a-t.scrollLeft,s?(0<(t=d+l-a+10-p)&&(s-=t),e.left="".concat(Math.min(c,Math.max(10,s)),"px")):f&&(0<(a=d+l-a+10-p)&&(f+=a),e.right="".concat(Math.max(10,f),"px")),m.style=e,m.maxHeight=i})),this.emitEvent("filter-visible",{column:u,property:u.property,filterList:this.getCheckedFilters(),visible:m.visible},e)},_getCheckedFilters:function(){var e=this.tableFullColumn,o=[];return e.filter(function(e){var t=e.property,i=e.filters,l=[],r=[];i&&i.length&&(i.forEach(function(e){e.checked&&(l.push(e.value),r.push(e.data))}),l.length&&o.push({column:e,property:t,values:l,datas:r}))}),o},confirmFilterEvent:function(e){var t=this,i=this.filterStore,l=this.filterOpts,r=this.scrollXLoad,o=this.scrollYLoad,n=i.column,s=n.property,f=[],a=[];n.filters.forEach(function(e){e.checked&&(f.push(e.value),a.push(e.data))});i=this.getCheckedFilters();l.remote||(this.handleTableData(!0),this.checkSelectionStatus(),this.updateFooter(),(r||o)&&(this.refreshScroll(),o&&this.updateScrollYSpace())),this.emitEvent("filter-change",{column:n,property:s,values:f,datas:a,filters:i,filterList:i},e),this.closeFilter(),this.$nextTick(function(){t.recalculate(),t.updateCellAreas()})},handleClearFilter:function(e){var t,i,l;e&&(t=e.filters,i=e.filterRender,t&&(i=i?_vXETable.default.renderer.get(i.name):null,l=e.filterResetMethod||(i?i.filterResetMethod:null),t.forEach(function(e){e._checked=!1,e.checked=!1,l||(e.data=_xeUtils.default.clone(e.resetValue,!0))}),l&&l({options:t,column:e,$table:this})))},resetFilterEvent:function(e){this.handleClearFilter(this.filterStore.column),this.confirmFilterEvent(e)},_clearFilter:function(e){var t,i=this.filterStore;return e?(t=(0,_util.handleFieldOrColumn)(this,e))&&this.handleClearFilter(t):this.visibleColumn.forEach(this.handleClearFilter),e&&t===i.column||Object.assign(i,{isAllSelected:!1,isIndeterminate:!1,style:null,options:[],column:null,multiple:!1,visible:!1}),this.updateData()}}};exports.default=_default;